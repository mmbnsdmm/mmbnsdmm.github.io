(self.webpackChunktest4vuecli=self.webpackChunktest4vuecli||[]).push([[3637],{26183:function(e,t,a){var n=a(88157);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(56).Z)("5c6be07a",n,!0,{sourceMap:!1,shadowMode:!1})},67470:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var n={"u-Text":a(4827).Z},i=a(4587),r=(a(35666),a(21249),a(57658),a(74916),a(77601),a(9653),{props:{urls:{type:Array,default:uni.$u.props.album.urls},keyName:{type:String,default:uni.$u.props.album.keyName},singleSize:{type:[String,Number],default:uni.$u.props.album.singleSize},multipleSize:{type:[String,Number],default:uni.$u.props.album.multipleSize},space:{type:[String,Number],default:uni.$u.props.album.space},singleMode:{type:String,default:uni.$u.props.album.singleMode},multipleMode:{type:String,default:uni.$u.props.album.multipleMode},maxCount:{type:[String,Number],default:uni.$u.props.album.maxCount},previewFullImage:{type:Boolean,default:uni.$u.props.album.previewFullImage},rowCount:{type:[String,Number],default:uni.$u.props.album.rowCount},showMore:{type:Boolean,default:uni.$u.props.album.showMore}}}),u={name:"u-album",mixins:[uni.$u.mpMixin,uni.$u.mixin,r],data:function(){return{singleWidth:0,singleHeight:0,singlePercent:.6}},watch:{urls:{immediate:!0,handler:function(e){1===e.length&&this.getImageRect()}}},computed:{imageStyle:function(){var e=this;return function(t,a){var n=e.space,i=e.rowCount,r=(e.multipleSize,e.urls,uni.$u),u=r.addUnit,o=(r.addStyle,e.showUrls.length),l=(e.urls.length,{marginRight:u(n),marginBottom:u(n)});return t===o&&(l.marginBottom=0),(a===i||t===o&&a===e.showUrls[t-1].length)&&(l.marginRight=0),l}},showUrls:function(){var e=this,t=[];return this.urls.map((function(a,n){if(n+1<=e.maxCount){var i=Math.floor(n/e.rowCount);t[i]||(t[i]=[]),t[i].push(a)}})),t},imageWidth:function(){return uni.$u.addUnit(1===this.urls.length?this.singleWidth:this.multipleSize)},imageHeight:function(){return uni.$u.addUnit(1===this.urls.length?this.singleHeight:this.multipleSize)},albumWidth:function(){var e=0;return e=1===this.urls.length?this.singleWidth:this.showUrls[0].length*this.multipleSize+this.space*(this.showUrls[0].length-1),this.$emit("albumWidth",e),e}},methods:{onPreviewTap:function(e){var t=this,a=this.urls.map((function(e){return t.getSrc(e)}));uni.previewImage({current:e,urls:a})},getSrc:function(e){return uni.$u.test.object(e)?this.keyName&&e[this.keyName]||e.src:e},getImageRect:function(){var e=this,t=this.getSrc(this.urls[0]);uni.getImageInfo({src:t,success:function(t){var a=t.width>=t.height;e.singleWidth=a?e.singleSize:t.width/t.height*e.singleSize,e.singleHeight=a?t.height/t.width*e.singleWidth:e.singleSize},fail:function(){e.getComponentWidth()}})},getComponentWidth:function(){var e=this;return(0,i.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,uni.$u.sleep(30);case 2:e.$uGetRect(".u-album__row").then((function(t){e.singleWidth=t.width*e.singlePercent}));case 3:case"end":return t.stop()}}),t)})))()}}},o=(a(26183),(0,a(69453).Z)(u,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"u-album"},e._l(e.showUrls,(function(t,n){return a("v-uni-view",{key:n,ref:"u-album__row",refInFor:!0,staticClass:"u-album__row",attrs:{forComputedUse:e.albumWidth}},e._l(t,(function(t,i){return a("v-uni-view",{key:i,staticClass:"u-album__row__wrapper",style:[e.imageStyle(n+1,i+1)],on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.previewFullImage&&e.onPreviewTap(e.getSrc(t))}}},[a("v-uni-image",{style:[{width:e.imageWidth,height:e.imageHeight}],attrs:{src:e.getSrc(t),mode:1===e.urls.length?e.imageHeight>0?e.singleMode:"widthFix":e.multipleMode}}),e.showMore&&e.urls.length>e.rowCount*e.showUrls.length&&n===e.showUrls.length-1&&i===e.showUrls[e.showUrls.length-1].length-1?a("v-uni-view",{staticClass:"u-album__row__wrapper__text"},[a("u--text",{attrs:{text:"+"+(e.urls.length-e.maxCount),color:"#fff",size:.3*e.multipleSize,align:"center",customStyle:"justify-content: center"}})],1):e._e()],1)})),1)})),1)}),[],!1,null,"243a8cff",null,!1,n,undefined)),l=o.exports},24940:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var n,i={uSubsection:a(97759).Z,uniCard:a(67017).Z,uLine:a(43996).Z,uniFav:a(43627).Z,uCellGroup:a(95759).Z,uCell:a(2991).Z,uButton:a(1445).Z,uAlbum:a(67470).Z,pagePagination:a(95299).Z,uEmpty:a(83525).Z,uniRow:a(50447).Z,uniCol:a(63933).Z,uAvatar:a(39489).Z,"u-Text":a(4827).Z,uniRate:a(17425).Z,"u-Textarea":a(51743).Z},r=a(4587),u=(a(35666),a(57658),a(77265),a(95299)),o=a(18445),l={name:"ResourceGalleryView",components:{PagePagination:u.Z,PageFooter:o.Z},beforeCreate:function(){n=this},onLoad:function(){n.getGallery()},activated:function(){n.getGallery()},data:function(){return{isGetting:!1,canReFlushGalleryCoutdown:"",isReFlushGallery:!1,isDownloadUrlShow:!1,gallery:{id:0},galleryMustBuy:0,isThumbShow:!1,criticismRateValue:0,criticismContentValue:"",subsectionData:{list:["内容","圈子"],current:0},pageDataContent:{pageSize:10,currentPage:1,items:[],count:0,total:0,pageCount:1},pageDataImage:{pageSize:12,currentPage:1,items:[],count:0,total:0,pageCount:1},pageDataTag:{pageSize:10,currentPage:1,items:[],count:0,total:0,pageCount:1},pageDataOrder:{pageSize:10,currentPage:1,items:[],count:0,total:0,pageCount:1}}},watch:{canReFlushGalleryCoutdown:function(e){e<=0&&(n.canReFlushGalleryCoutdown="")}},methods:{getGallery:function(){return(0,r.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isGetting){e.next=10;break}return n.isGetting=!0,e.next=4,n.$model.Resource.getOrSetCacheById(n.$route.query.id,n.$Route.query.updated_at);case 4:return n.gallery=e.sent,n.gallery.created_by!==n.$store.getters["Auth/getUserInfo"].id&&n.gallery.price>0&&0===n.gallery._isBuy&&(n.galleryMustBuy=1),n.gallery.price>0&&n.subsectionData.list.length<3&&n.subsectionData.list.push("买家评价"),e.next=9,n.changeImagePage();case 9:n.isGetting=!1;case 10:case"end":return e.stop()}}),e)})))()},reFlushGallery:function(){n.getGallery()},editGallery:function(e){uni.navigateTo({url:"/pages/resource/gallery/Edit?id="+e.id})},subsectionSectionChange:function(e){n.subsectionData.current=e,1===e&&n.gallery._tag_total>0&&n.pageDataTag.count<=0&&n.getTagList(1),2===e&&n.getOrderList(1)},getImageList:function(e){return(0,r.Z)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$api.post("/resource/default/get-image-list-by-id",{id:n.gallery.id,page:e-1});case 2:a=t.sent,n.pageDataImage.total=a._meta.totalCount,n.pageDataImage.pageCount=a._meta.pageCount,n.pageDataImage.pageSize=a._meta.perPage,n.pageDataImage.currentPage=a._meta.currentPage+1,n.pageDataImage.count=a.count,n.pageDataImage.items=a.items;case 9:case"end":return t.stop()}}),t)})))()},changeImagePage:function(e){n.getImageList(e)},getTagList:function(e){return(0,r.Z)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$api.post("/resource/default/get-tag-list-by-id",{id:n.gallery.id,page:e-1});case 2:a=t.sent,n.pageDataTag.total=a._meta.totalCount,n.pageDataTag.pageCount=a._meta.pageCount,n.pageDataTag.pageSize=a._meta.perPage,n.pageDataTag.currentPage=a._meta.currentPage+1,n.pageDataTag.count=a.count,n.pageDataTag.items=a.items;case 9:case"end":return t.stop()}}),t)})))()},changeTagPage:function(e){n.getTagList(e)},getOrderList:function(e){return(0,r.Z)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$api.post("/resource/default/get-order-list-by-id",{id:n.gallery.id,page:e-1});case 2:a=t.sent,n.pageDataOrder.total=a._meta.totalCount,n.pageDataOrder.pageCount=a._meta.pageCount,n.pageDataOrder.pageSize=a._meta.perPage,n.pageDataOrder.currentPage=a._meta.currentPage+1,n.pageDataOrder.count=a.count,n.pageDataOrder.items=a.items;case 9:case"end":return t.stop()}}),t)})))()},changeOrderPage:function(e){n.getOrderList(e)},criticism:function(e){uni.showModal({title:"提示",content:"确定要评价吗？每单只能评价一次，完成后不能修改！",success:function(t){t.confirm&&n.$api.post("/resource/order/criticism",{order_id:e.id,rate:n.criticismRateValue,msg:n.criticismContentValue}).then((function(e){uni.$u.toast("评价成功"),n.getOrderList(n.pageDataOrder.currentPage)}))}})},buy:function(e){100*n.$store.getters["Auth/getUserInfo"].balance<100*n.gallery.price?n.$u.toast("余额不足"):uni.showModal({title:"购买提示",content:"确定要购买这个视频吗？",success:function(t){t.confirm&&n.$api.post("/resource/default/buy",{id:e.id}).then((function(t){uni.$u.toast("购买成功"),n.$model.Resource.deleteCacheById(e.id),location.reload()}))}})},cz:function(){uni.showModal({title:"跳转提示",content:"确定要去充值吗？",success:function(e){e.confirm&&uni.navigateTo({url:"/pages/user/wallet/Cz"})}})},toTag:function(e){uni.navigateTo({url:"/pages/tag/Info?id="+e.id+"&updated_at="+e.updated_at})},forceView:function(){n.galleryMustBuy=0},copyDownloadUrl:function(){return(0,r.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.gallery._imagesDownloadUrl,e.prev=1,e.next=4,navigator.clipboard.writeText(t);case 4:uni.$u.toast("复制成功"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),n.copyText(t);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})))()},copyText:function(e){var t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")?uni.$u.toast("文本已成功复制到剪贴板"):(uni.$u.toast("复制失败，你可以扫码下载"),n.isDownloadUrlShow=!0)}catch(e){uni.$u.toast("复制失败，你可以扫码下载"),n.isDownloadUrlShow=!0}finally{document.body.removeChild(t)}}}},s=(0,a(69453).Z)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"container"},[e.gallery.id>0?a("v-uni-view",[a("u-subsection",{attrs:{list:e.subsectionData.list,current:e.subsectionData.current},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.subsectionSectionChange.apply(void 0,arguments)}}}),a("v-uni-view",{class:{"p-[15px]":!0}},[0===e.subsectionData.current?a("v-uni-view",[a("uni-card",{attrs:{margin:"0",padding:"0",spacing:"0",thumbnail:e.gallery._createdBy.avatar,title:e.gallery._createdBy.username,"sub-title":e.gallery._createdBy.email,extra:e.$moment(1e3*e.gallery.created_at).fromNow()},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$model.User.toProfile(e.gallery.created_by)}}}),a("u-line"),a("v-uni-view",[e.gallery.created_by!==e.$store.getters["Auth/getUserInfo"].id?a("uni-fav",{staticClass:"float-left",attrs:{checked:!!e.gallery._isFav},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$model.Resource.toggleFav(e.gallery)}}}):e._e(),1===e.gallery.privacy_status?a("i",{staticClass:"iconfont xuba5-password1",style:{color:"#ff9300"}}):e._e(),2===e.gallery.privacy_status?a("i",{staticClass:"iconfont xuba5-fy_ic_unlock",style:{color:"#1afa29"}}):e._e(),e.gallery._canEdit?a("i",{staticClass:"float-right iconfont xuba5-edit-fill",style:{color:"#1296db","font-size":"20px","margin-top":"2px"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.editGallery(e.gallery)}}}):e._e(),e.gallery._canEdit?a("i",{staticClass:"float-right iconfont xuba5-delete",style:{color:"#d81e06","font-size":"20px","margin-top":"2px"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$model.Resource.del(e.gallery)}}}):e._e()],1),a("u-line",{attrs:{color:"#2979ff"}}),a("u-cell-group",[a("u-cell",{attrs:{title:"图片数",value:e.gallery._image_total+"张"}})],1),e.galleryMustBuy>0?a("v-uni-view",[a("u-cell-group",[a("u-cell",{attrs:{title:"价格",value:"￥"+e.gallery.price}}),a("u-cell",{attrs:{title:"你的余额",value:"￥"+e.$store.getters["Auth/getUserInfo"].balance}}),a("u-cell",{attrs:{title:"收益人",value:e.gallery._createdBy.username}}),a("u-cell",{attrs:{title:"收益人邮箱",value:e.gallery._createdBy.email}})],1),a("v-uni-view",[a("u-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.buy(e.gallery)}}},[e._v("购买")]),a("u-button",{attrs:{type:"warning"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.cz.apply(void 0,arguments)}}},[e._v("充值")]),e.$store.getters["Auth/getUserInfo"].is_admin?a("u-button",{attrs:{type:"error"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.forceView.apply(void 0,arguments)}}},[e._v("强制查看")]):e._e()],1),a("v-uni-view",[e._v("预览图")]),a("v-uni-view",[a("u-album",{attrs:{urls:e.gallery._covers,rowCount:"3",maxCount:"12"}})],1)],1):a("v-uni-view",[a("v-uni-view",[a("u-button",{class:{"mb-[5px]":!0},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.copyDownloadUrl.apply(void 0,arguments)}}},[e._v("复制下载链接")]),e.isDownloadUrlShow?a("v-uni-view",[e._v(e._s(e.video._videos[0]._userFile._fileDownloadAburl)),e.isDownloadUrlShow?a("v-uni-image",{attrs:{mode:"aspectFit",src:e.video._videos[0]._userFile._fileDownloadQrcode}}):e._e(),a("u-button",{class:{"mb-[5px]":!0},attrs:{type:"warning"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.isDownloadUrlShow=!e.isDownloadUrlShow}}},[e._v("隐藏链接二维码")])],1):e._e()],1),a("v-uni-view",[a("u-album",{attrs:{urls:e.pageDataImage.items,rowCount:"3",maxCount:"12"}})],1),e.pageDataImage.total>10?a("page-pagination",{attrs:{total:e.pageDataImage.total,pageSize:e.pageDataImage.pageSize,currentPage:e.pageDataImage.currentPage,showAround:!0,forceEllipses:!0,numAround:!0,showPageSize:6,showPageInfo:!0,showGoPage:!0},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.changeImagePage.apply(void 0,arguments)}}}):e._e()],1)],1):e._e(),1===e.subsectionData.current?a("v-uni-view",[e.gallery._tag_total<1?a("v-uni-view",[a("u-empty",{attrs:{mode:"list"}})],1):e._e(),e._l(e.pageDataTag.items,(function(t,n){return a("v-uni-view",{key:n},[a("v-uni-view",[e._v(e._s(t.name)),t._isJoinIn?a("u-button",{staticClass:"float-right",staticStyle:{width:"fit-content"},attrs:{size:"mini",type:"info"},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.toTag(t)}}},[e._v("进入")]):e._e(),t._isJoinIn?a("u-button",{staticClass:"float-right",staticStyle:{width:"fit-content"},attrs:{size:"mini",type:"warning"},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.$model.Tag.exit(t)}}},[e._v("退出")]):e._e(),t._isJoinIn?e._e():a("u-button",{staticClass:"float-right",staticStyle:{width:"fit-content"},attrs:{size:"mini",type:"primary"},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.$model.Tag.joinIn(t)}}},[e._v("加入")])],1),a("u-line",{attrs:{color:"#2979ff"}})],1)})),e.pageDataTag.total>10?a("page-pagination",{attrs:{total:e.pageDataTag.total,pageSize:e.pageDataTag.pageSize,currentPage:e.pageDataTag.currentPage,showAround:!0,forceEllipses:!0,numAround:!0,showPageSize:6,showPageInfo:!0,showGoPage:!0},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.changeTagPage.apply(void 0,arguments)}}}):e._e()],2):e._e(),2===e.subsectionData.current?a("v-uni-view",[e.gallery._order_total<1?a("v-uni-view",[a("u-empty",{attrs:{mode:"list"}})],1):e._e(),e._l(e.pageDataOrder.items,(function(t,n){return a("v-uni-view",{key:n},[a("uni-row",{class:{"pb-[15px]":!0}},[a("uni-col",{attrs:{span:4}},[a("u-avatar",{attrs:{shape:"square",src:t._createdBy.avatar},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.$model.User.toProfile(t.created_by)}}})],1),a("uni-col",{attrs:{span:20}},[a("u--text",{attrs:{text:t._createdBy.username,type:"primary",bold:!0,size:"16"}}),a("v-uni-view",{class:{"mt-[5px]":!0}}),null===t.buyer_rate?a("v-uni-view",[t.created_by===e.$store.getters["Auth/getUserInfo"].id?a("v-uni-view",[a("uni-rate",{model:{value:e.criticismRateValue,callback:function(t){e.criticismRateValue=t},expression:"criticismRateValue"}}),a("v-uni-view",{class:{"mt-[5px]":!0}}),a("v-uni-view",[a("u--textarea",{attrs:{placeholder:"请输入评价内容，只能评价一次，评价完后不可修改评价"},model:{value:e.criticismContentValue,callback:function(t){e.criticismContentValue=t},expression:"criticismContentValue"}})],1),a("v-uni-view",{class:{"mt-[5px]":!0}}),a("u-button",{staticClass:"float-left",staticStyle:{width:"fit-content"},attrs:{type:"primary"},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.criticism(t)}}},[e._v("评价")])],1):a("v-uni-view",[e._v("未评价")])],1):a("v-uni-view",[a("uni-rate",{attrs:{value:t.buyer_rate,readonly:!0}}),a("v-uni-view",{class:{"mt-[5px]":!0}}),a("v-uni-view",[e._v(e._s(t.buyer_criticism))])],1)],1)],1)],1)})),e.pageDataOrder.total>10?a("page-pagination",{attrs:{total:e.pageDataOrder.total,pageSize:e.pageDataOrder.pageSize,currentPage:e.pageDataOrder.currentPage,showAround:!0,forceEllipses:!0,numAround:!0,showPageSize:6,showPageInfo:!0,showGoPage:!0},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.changeOrderPage.apply(void 0,arguments)}}}):e._e()],2):e._e()],1)],1):e._e(),e._e()],1)}),[],!1,null,"45c232e4",null,!1,i,undefined),c=s.exports},88157:function(e,t,a){"use strict";a.r(t);var n=a(43481),i=a.n(n),r=a(2400),u=a.n(r)()(i());u.push([e.id,"@import url(https://at.alicdn.com/t/c/font_3814524_b71c6o96iok.css);"]),u.push([e.id,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 需要放到文件最上面 */\n/* 水平间距 */\n/* 水平间距 */\n/*\n 以下变量是默认值，如不需要修改可以不用给下面的变量重新赋值\n */\n/* 水平间距 */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */\n/* iconfont */uni-view[data-v-243a8cff], uni-scroll-view[data-v-243a8cff], uni-swiper-item[data-v-243a8cff]{display:flex;flex-direction:column;flex-shrink:0;flex-grow:0;flex-basis:auto;align-items:stretch;align-content:flex-start}.u-album[data-v-243a8cff]{\ndisplay:flex;\nflex-direction:column}.u-album__row[data-v-243a8cff]{\ndisplay:flex;\nflex-direction:row;flex-wrap:wrap}.u-album__row__wrapper[data-v-243a8cff]{position:relative}.u-album__row__wrapper__text[data-v-243a8cff]{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.3);\ndisplay:flex;\nflex-direction:row;justify-content:center;align-items:center}',""]),t.default=u}}]);